<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Team Jersey Customizer</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React and ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react.development.js"></script>
    <!-- Load Babel for JSX compilation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-dark': '#111827',
                        'secondary-dark': '#1f2937',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 font-sans">

    <!-- Root container for React app -->
    <div id="root"></div>

    <script type="text/babel">
        // Import necessary hooks from React
        const { useState, useCallback, useRef, useEffect } = React;
        
        // --- INLINE SVG ICON DEFINITIONS ---
        const Image = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>;
        const Loader = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 1-9 9 9 9 0 0 1-9-9 9 9 0 0 1 9-9"></path><line x1="12" x2="12" y1="2" y2="6"></line><line x1="12" x2="12" y1="18" y2="22"></line><line x1="4.22" x2="6.6" y1="4.22" y2="6.6"></line><line x1="17.39" x2="19.78" y1="17.39" y2="19.78"></line><line x1="2" x2="6" y1="12" y2="12"></line><line x1="18" x2="22" y1="12" y2="12"></line><line x1="4.22" x2="6.6" y1="19.78" y2="17.39"></line><line x1="17.39" x2="19.78" y1="6.6" y2="4.22"></line></svg>;
        const Zap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const Shirt = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.38 3.46l-2.88 2.88a6 6 0 0 0-8.62 0l-2.88-2.88A6 6 0 0 0 2 6v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a6 6 0 0 0-1.62-2.54zM12 2v2"></path></svg>;
        const Palette = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c.06 0 .11 0 .17 0l-1.99-2.22A8 8 0 0 1 12 4a8 8 0 0 1 8 8 8 8 0 0 1-1.82 5.22L20.83 22c.06 0 .11 0 .17 0 5.52 0 10-4.48 10-10S17.52 2 12 2z"/></svg>;
        const User = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Upload = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const FileText = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const Dribbble = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16 8h-4v8H8"/><path d="M12 8l4 4-4 4"/></svg>;
        const Goal = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22C6.48 22 2 17.52 2 12S6.48 2 12 2s10 4.48 10 10-4.48 10-10 10z"/><path d="M12 2l4 4-4 4-4-4z"/></svg>;
        const TrendingUp = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="21 6 15 12 18 15 12 21"/><path d="M17 6h4v4"/><path d="M3 18l6-6 4 4 6-6"/></svg>;
        const Trophy = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 9a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h0a2 2 0 0 1-2-2V9z"/><path d="M12 20a5 5 0 0 0 5-5H7a5 5 0 0 0 5 5z"/><path d="M16 11V5l4-2"/><path d="M8 11V5L4 3"/></svg>;
        const Shield = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-12V5l-8-3-8 3v5c0 8 8 12 8 12z"/></svg>;
        const Layers = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19c-3.3 0-6-1.3-6-3s2.7-3 6-3 6 1.3 6 3-2.7 3-6 3z"/><path d="M12 16c-3.3 0-6-1.3-6-3s2.7-3 6-3 6 1.3 6 3-2.7 3-6 3z"/><path d="M12 13c-3.3 0-6-1.3-6-3s2.7-3 6-3 6 1.3 6 3-2.7 3-6 3z"/></svg>;
        
        // Transparent 1x1 PNG Base64 Data. 
        const BLANK_LOGO_BASE64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';

        // List of available sports jersey types
        const JERSEY_TYPES = [
            { value: 'baseball', label: 'Baseball', icon: Trophy },
            { value: 'basketball', label: 'Basketball', icon: Dribbble },
            { value: 'cycling', label: 'Cycling', icon: TrendingUp },
            { value: 'field_hockey', label: 'Field Hockey', icon: Goal },
            { value: 'football', label: 'Football', icon: Shield },
            { value: 'hockey', label: 'Hockey', icon: Shield },
            { value: 'lacrosse', label: 'Lacrosse', icon: Shield },
            { value: 'rugby', label: 'Rugby', icon: Shield },
            { value: 'soccer', label: 'Soccer', icon: Goal },
            { value: 'softball', label: 'Softball', icon: Trophy },
            { value: 'track_and_field', label: 'Track & Field', icon: TrendingUp },
            { value: 'volleyball', label: 'Volleyball', icon: Dribbble },
            { value: 'wrestling', label: 'Wrestling', icon: User },
        ];

        /**
         * Converts a File object (Image) into a Base64 string for the API payload.
         * @param {File} file The image file object.
         * @returns {Promise<string>} Base64 encoded data string (without prefix).
         */
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64Data = reader.result.split(',')[1];
                    if (!base64Data) {
                        reject(new Error("Failed to extract Base64 data from file."));
                    } else {
                        resolve(base64Data);
                    }
                };
                reader.onerror = (error) => reject(error);
            });
        };

        // Helper component for text inputs
        const InputGroup = ({ label, icon: Icon, value, onChange, placeholder, color }) => (
            <div className="flex flex-col space-y-2">
                <label className="text-sm font-medium text-gray-300 flex items-center">
                    <Icon className={`w-4 h-4 mr-2 ${color}`} />
                    {label}
                </label>
                <input
                    type="text"
                    value={value}
                    onChange={onChange}
                    placeholder={placeholder}
                    className="p-3 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 bg-gray-700 text-white"
                />
            </div>
        );

        // Helper component for color pickers
        const ColorPickerGroup = ({ label, value, onChange, color }) => (
            <div className="flex flex-col space-y-2">
                <label className="text-sm font-medium text-gray-300 flex items-center">
                    <Palette className={`w-4 h-4 mr-2 ${color}`} />
                    {label}
                </label>
                <div className="flex items-center space-x-3">
                    <input
                        type="color"
                        value={value}
                        onChange={onChange}
                        className="w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-700 p-0"
                        style={{ backgroundColor: value }}
                    />
                    <input
                        type="text"
                        value={value}
                        onChange={onChange}
                        className="p-3 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 bg-gray-700 text-white w-24 font-mono"
                    />
                </div>
            </div>
        );

        const App = () => {
            // --- State for Customization Inputs ---
            const [jerseyType, setJerseyType] = useState('basketball');
            const [teamName, setTeamName] = useState('VICTORY');
            const [primaryColor, setPrimaryColor] = useState('#EF4444'); // Red
            const [secondaryColor, setSecondaryColor] = useState('#FFFFFF'); // White
            const [thirdColor, setThirdColor] = useState('#10B981'); // Green Accent
            const [designElements, setDesignElements] = useState('');

            // State for Logo Management
            const [logoFile, setLogoFile] = useState(null);
            const [logoPreviewUrl, setLogoPreviewUrl] = useState('');
            const [logoDescription, setLogoDescription] = useState('A clean text logo or simple design placed on the center chest.');
            
            const fileInputRef = useRef(null);

            // --- State for Image Generation ---
            const [imageUrl, setImageUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            
            // NOTE: API_KEY is now handled by the backend proxy server.
            const apiKeyProvided = true; // Assume proxy is configured

            // Cleanup object URL when component unmounts or logo changes
            useEffect(() => {
                return () => {
                    if (logoPreviewUrl) {
                        URL.revokeObjectURL(logoPreviewUrl);
                    }
                };
            }, [logoPreviewUrl]);

            // Handler for logo file upload
            const handleLogoUpload = (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    if (logoPreviewUrl) {
                        URL.revokeObjectURL(logoPreviewUrl);
                    }
                    setLogoFile(file);
                    const newUrl = URL.createObjectURL(file);
                    setLogoPreviewUrl(newUrl);
                    // Update prompt to focus on using the uploaded image
                    setLogoDescription(`Please use the attached logo file, named "${file.name}". Render this exact logo prominently placed on the center chest area.`);
                } else {
                    setLogoFile(null);
                    setLogoPreviewUrl('');
                    setLogoDescription('A clean text logo or simple design placed on the center chest.');
                }
            };


            // Exponential backoff retry function for API calls (still needed for robust network access to the proxy)
            const withRetry = useCallback(async (fn, retries = 3) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        return await fn();
                    } catch (err) {
                        if (i === retries - 1) throw err;
                        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }, []);

            // --- Dynamic Prompt Builder ---
            const constructPrompt = useCallback((hasRealLogo) => {
                const typeLabel = JERSEY_TYPES.find(t => t.value === jerseyType)?.label || 'Jersey';
                
                const designInstruction = designElements.trim() 
                    ? `- Pattern/Design: Incorporate the following design elements: ${designElements}.` 
                    : '';

                let logoInstruction;

                if (hasRealLogo) {
                    // Case 1: Real Logo Uploaded. Tell the AI to use the image.
                    logoInstruction = `Use the attached image as the logo. Place this exact logo on the center chest.`;
                } else {
                    // Case 2: No Logo Uploaded. Tell the AI to IGNORE the blank image 
                    logoInstruction = `**NO EXTERNAL LOGO IS PROVIDED.** Ignore the blank image input. Instead, the logo should be the team name, "${teamName.toUpperCase()}", rendered as a clean, sharp decal in the Secondary Color. Place this decal prominently on the center chest as the main graphic.`;
                }

                const detailPrompt = `
                    **CRITICAL COLOR AND TEXT ENFORCEMENT:** The jersey MUST STRICTLY use these three hex colors: Primary: ${primaryColor}, Secondary: ${secondaryColor}, Accent: ${thirdColor}. AVOID ALL other prominent colors.
                    
                    Render a highly detailed, photorealistic front and back mockup of a team ${typeLabel} jersey, 
                    hanging naturally with subtle fabric folds, made of modern synthetic fabric. 
                    
                    Key Features: 
                    - Main Fabric Color: ${primaryColor}
                    - Trim and Number Color: ${secondaryColor}
                    - Accent Color: ${thirdColor}
                    - ${logoInstruction}
                    - Numbers: Use a legible font for the numbers, rendered in the Secondary Color.
                    - Text Quality: The word "${teamName.toUpperCase()}" MUST be clean and correctly spelled. AVOID ALL GIBBERISH OR EXTRANEOUS TEXT ARTIFACTS on the jersey or background.
                    ${designInstruction}
                    
                    Style: Soft studio lighting, hyper-realistic, 8k resolution, clean white background, no watermarks.
                `;
                
                return detailPrompt;
            }, [jerseyType, teamName, primaryColor, secondaryColor, thirdColor, designElements]);

            // --- Image Generation Handler (Now calls the proxy server) ---
            const generateImage = useCallback(async () => {
                setIsLoading(true);
                setError(null);
                setImageUrl('');

                let base64ImageToUse;
                let mimeTypeToUse;
                let hasRealLogo = false;

                if (logoFile) {
                    try {
                        base64ImageToUse = await fileToBase64(logoFile);
                        mimeTypeToUse = logoFile.type;
                        hasRealLogo = true;
                    } catch (e) {
                        console.error("Error reading logo file:", e);
                        setError("Could not read the uploaded logo file. Please try a different image.");
                        setIsLoading(false);
                        return;
                    }
                
                } else {
                    base64ImageToUse = BLANK_LOGO_BASE64;
                    mimeTypeToUse = 'image/png';
                }
                
                const prompt = constructPrompt(hasRealLogo);

                // --- UPDATED NETLIFY FUNCTION ENDPOINT ---
                const proxyUrl = '/.netlify/functions/generate-jersey'; 

                const payload = {
                    prompt: prompt,
                    logoData: {
                        mimeType: mimeTypeToUse,
                        data: base64ImageToUse
                    }
                };

                try {
                    const fetchFn = async () => {
                        // The frontend sends the entire payload to the backend proxy
                        const response = await fetch(proxyUrl, { 
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        // The proxy sends back a simplified JSON response
                        const result = await response.json(); 

                        if (!response.ok) {
                            // Handle errors sent back by the proxy server
                            throw new Error(result.error || `Proxy error: ${response.statusText}`);
                        }

                        if (result.base64Data) {
                            setImageUrl(`data:image/png;base64,${result.base64Data}`);
                        } else {
                            setError("Proxy call failed to return image data.");
                        }
                        return result; // Return result for the retry mechanism
                    };

                    await withRetry(fetchFn);
                    
                } catch (err) {
                    console.error("Image generation error:", err);
                    setError(`Failed to generate image. Please ensure your Netlify Function is deployed and configured correctly. (${err.message})`);
                } finally {
                    setIsLoading(false);
                }
            }, [constructPrompt, withRetry, logoFile]); 

            // Find the current icon based on the selected jersey type
            const currentJerseyType = JERSEY_TYPES.find(t => t.value === jerseyType);
            const IconComponent = currentJerseyType?.icon || Shirt;


            return (
                <div className="min-h-screen bg-gray-900 text-gray-200 p-4 sm:p-8 font-sans">
                    <h1 className="text-4xl font-extrabold text-center mb-12 flex items-center justify-center text-white">
                        <Image className="w-9 h-9 mr-3 text-purple-400" />
                        AI Team Jersey Customizer
                    </h1>

                    {/* API Key Warning - Now a Proxy/Deployment Warning */}
                    <div className="bg-blue-600/20 border-l-4 border-blue-500 text-blue-100 p-4 mb-6 rounded-lg max-w-6xl mx-auto" role="alert">
                        <p className="font-bold">NETLIFY FUNCTION REQUIRED FOR FUNCTIONALITY</p>
                        <p>This front-end is now configured to call the Netlify Function at `/.netlify/functions/generate-jersey`. Follow the deployment guide to secure your API key as an **environment variable** on Netlify.</p>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 max-w-6xl mx-auto">
                        
                        {/* Left Side: Customization Controls */}
                        <div className="lg:w-1/3 bg-gray-800 p-6 rounded-2xl shadow-2xl h-fit">
                            <h2 className="text-2xl font-semibold mb-6 border-b pb-2 border-gray-700 text-white flex items-center">
                                <Palette className="w-5 h-5 mr-2 text-blue-400" />
                                Customization Controls
                            </h2>
                            
                            <div className="space-y-5">
                                
                                {/* 1. Jersey Type */}
                                <div className="flex flex-col space-y-2">
                                    <label className="text-sm font-medium text-gray-300 flex items-center">
                                        <Shirt className="w-4 h-4 mr-2 text-yellow-400" />
                                        Jersey Type
                                    </label>
                                    <select
                                        value={jerseyType}
                                        onChange={(e) => setJerseyType(e.target.value)}
                                        className="p-3 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 bg-gray-700 text-white appearance-none cursor-pointer"
                                    >
                                        {JERSEY_TYPES.map(type => (
                                            <option key={type.value} value={type.value}>{type.label}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                {/* 2. Team Name */}
                                <InputGroup 
                                    label="Team Name/Text (Max 15 Chars)"
                                    icon={User}
                                    value={teamName}
                                    onChange={(e) => setTeamName(e.target.value.toUpperCase().slice(0, 15))}
                                    placeholder="e.g., WARRIORS"
                                    color="text-green-400"
                                />
                                
                                {/* 3. Primary Color */}
                                <ColorPickerGroup 
                                    label="Primary Color (Body)"
                                    value={primaryColor}
                                    onChange={(e) => setPrimaryColor(e.target.value)}
                                    color="text-red-400"
                                />

                                {/* 4. Secondary Color */}
                                <ColorPickerGroup 
                                    label="Secondary Color (Trim/Numbers)"
                                    value={secondaryColor}
                                    onChange={(e) => setSecondaryColor(e.target.value)}
                                    color="text-blue-400"
                                />
                                
                                {/* 5. Third Color */}
                                <ColorPickerGroup 
                                    label="Third Color (Accent)"
                                    value={thirdColor}
                                    onChange={(e) => setThirdColor(e.target.value)}
                                    color="text-yellow-400"
                                />

                                {/* Specific Design Elements */}
                                <div className="flex flex-col space-y-2">
                                    <label className="text-sm font-medium text-gray-300 flex items-center">
                                        <Layers className="w-4 h-4 mr-2 text-cyan-400" />
                                        Design Patterns & Elements (e.g., Stripes, Gradient)
                                    </label>
                                    <textarea
                                        rows="2"
                                        value={designElements}
                                        onChange={(e) => setDesignElements(e.target.value)}
                                        className="w-full p-3 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 bg-gray-700 text-white resize-none"
                                        placeholder="e.g., Vertical pinstripes in secondary color, subtle geometric pattern."
                                    />
                                    <p className="text-xs text-gray-500">
                                        This text guides the AI on specific visual features of the jersey fabric or cut.
                                    </p>
                                </div>

                                {/* 6. Logo Upload & Description */}
                                <div className="flex flex-col space-y-2">
                                    <label className="text-sm font-medium text-gray-300 flex items-center">
                                        <Upload className="w-4 h-4 mr-2 text-purple-400" />
                                        Logo File Upload
                                    </label>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={handleLogoUpload}
                                        ref={fileInputRef}
                                        className="block w-full text-sm text-gray-400
                                            file:mr-4 file:py-2 file:px-4
                                            file:rounded-full file:border-0
                                            file:text-sm file:font-semibold
                                            file:bg-purple-500 file:text-white
                                            hover:file:bg-purple-600 cursor-pointer
                                        "
                                    />
                                    
                                    {logoPreviewUrl && (
                                        <div className="mt-4 p-3 bg-gray-700 rounded-lg flex items-center space-x-3">
                                            <img src={logoPreviewUrl} alt="Logo Preview" className="w-10 h-10 object-contain rounded" />
                                            <span className="text-xs text-gray-300 truncate">{logoFile.name}</span>
                                            <button 
                                                onClick={() => {
                                                    setLogoFile(null);
                                                    setLogoPreviewUrl('');
                                                    setLogoDescription('A clean text logo or simple design placed on the center chest.');
                                                    fileInputRef.current.value = ''; // Reset file input
                                                }}
                                                className="text-red-400 hover:text-red-500 text-xs ml-auto"
                                            >
                                                Remove
                                            </button>
                                        </div>
                                    )}

                                    <label className="text-sm font-medium text-gray-300 flex items-center pt-4">
                                        <FileText className="w-4 h-4 mr-2 text-purple-400" />
                                        Logo Placement Description (For AI Rendering)
                                    </label>
                                    <textarea
                                        rows="2"
                                        value={logoDescription}
                                        onChange={(e) => setLogoDescription(e.target.value)}
                                        className="w-full p-3 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 bg-gray-700 text-white resize-none"
                                        placeholder="Describe the logo you uploaded (e.g., A fierce red dragon head)"
                                    />
                                    <p className="text-xs text-gray-500">
                                        The AI uses the **image file itself** along with this text description for best results.
                                    </p>
                                </div>

                                {/* Generate Button */}
                                <button
                                    onClick={generateImage}
                                    disabled={isLoading}
                                    className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50 transition duration-150 ease-in-out shadow-lg disabled:opacity-50 mt-6"
                                >
                                    {isLoading ? (
                                        <>
                                            <Loader className="animate-spin w-5 h-5 mr-3" />
                                            Requesting Mockup from Netlify...
                                        </>
                                    ) : (
                                        <>
                                            <Zap className="w-5 h-5 mr-2" />
                                            Generate High-Quality Mockup
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Right Side: Jersey Preview */}
                        <div className="lg:w-2/3 bg-gray-800 p-6 rounded-2xl shadow-2xl flex flex-col items-center justify-center min-h-[500px]">
                            <h2 className="text-2xl font-semibold mb-4 text-white flex items-center">
                                <IconComponent className="w-6 h-6 mr-2 text-yellow-400" />
                                {currentJerseyType?.label || 'Jersey'} Preview
                            </h2>
                            <div className="w-full h-full aspect-square bg-gray-700 flex items-center justify-center rounded-xl overflow-hidden p-8">
                                {error && (
                                    <div className="text-red-400 p-6 bg-red-900/50 rounded-lg w-full text-center">
                                        **Generation Error:** {error}
                                    </div>
                                )}
                                {isLoading && (
                                    <div className="flex flex-col items-center justify-center text-purple-400">
                                        <Loader className="animate-spin w-16 h-16 mb-4" />
                                        <p className="text-lg font-medium">AI is generating your custom jersey...</p>
                                    </div>
                                )}
                                {imageUrl && !isLoading && (
                                    <img 
                                        src={imageUrl} 
                                        alt="AI Generated Team Jersey Mockup" 
                                        className="w-full h-auto rounded-lg shadow-2xl transition-transform duration-500"
                                    />
                                )}
                                {!imageUrl && !isLoading && !error && (
                                    <div className="text-gray-500 dark:text-gray-400 text-center p-6">
                                        <Image className="w-16 h-16 mx-auto mb-3" />
                                        <p>Customize your design and click 'Generate High-Quality Mockup' to send the request to your secure server.</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the main App component
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>